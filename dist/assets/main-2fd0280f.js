var C=Object.defineProperty;var g=(d,t,e)=>t in d?C(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var l=(d,t,e)=>(g(d,typeof t!="symbol"?t+"":t,e),e);import{L as v,o as m,s as E,a as S,E as L,S as y,g as b,b as f,c as w}from"./assets-c3312261.js";class I{constructor(t="bottom-right"){l(this,"position","");l(this,"open",!1);l(this,"info",!1);l(this,"widgetContent",null);this.position=this.getPosition(t),this.ask_email_copy="Hi! Want to know about our special offer 👀?",this.ask_email_page=!0,this.widgetID="__HASH__",this.adminStatus=!1,this.DOMLoaded=!1,this.open=!1,this.visitor={},this.unreadChatCount=0,this.SSElink=null,this.initialize(),this.injectStyles(),this.LoadUpsequence=v,this.LoadUpsequence(),this.openChat=m,this.openChat(),this.stopChat=E,this.stopChat(),this.sendChat=S,this.sendChat(),this.EmitIsTyping=L,this.EmitIsTyping(),this.SetVisitorEmail=y,this.SetVisitorEmail(),this.getWSlink=b,this.getWSlink()}getPosition(t){const[e,i]=t.split("-");return{[e]:"28px",[i]:"40px"}}async initialize(){const t=document.createElement("div");t.classList.add("main__container"),t.style.position="fixed",t.style.zIndex="20",Object.keys(this.position).forEach(a=>t.style[a]=this.position[a]),document.body.appendChild(t),this.mainWidgetContainer=t;const e=document.createElement("button");e.classList.add("widget-button__container"),this.buttonContainer=e;const i=document.createElement("div");i.innerHTML='<i class="fa-regular fa-messages-question"></i>',i.classList.add("widget__icon"),i.addEventListener("click",this.toggleOpen.bind(this)),this.widgetIcon=i;const n=document.createElement("div");n.innerHTML='<i class="fa-sharp fa-light fa-paper-plane-top"></i>',n.classList.add("widget__icon","widget__hidden"),n.addEventListener("click",()=>{this.sendChat(this.chat_room_input),this.chat_room_input.value=""}),this.sendIcon=n;const s=document.createElement("span");s.textContent=this.unreadChatCount,s.classList.add("unread_chat_count__span"),this.unreadChatCountSpan=s,e.appendChild(this.widgetIcon),e.appendChild(this.sendIcon),this.widgetContainer=document.createElement("div"),this.widgetContainer.classList.add("widget__content"),this.widgetContainer.classList.add("content__hidden"),document.addEventListener("DOMContentLoaded",()=>{this.DOMLoaded||(this.LoadUpsequence(this.widgetID),this.handleSSEConnection(),this.DOMLoaded=!0)}),this.createWidgetContent(),t.appendChild(this.widgetContainer),t.appendChild(e)}createWidgetContent(){this.widgetContainer.innerHTML=`
      <div class="widget__header">
        <div class="header-icons__container">
          <span class="close-icon">
            <i class="fa-solid fa-arrow-right-from-arc"></i>
          </span>
        </div>
        <div id="chatbot__status">
          <h3 id="chatroom__title">Name of the Chatbot</h3>
          <p><i class="fa-solid fa-circle status-circle__icon ${this.adminStatus?"status__online":"status__offline"}"></i>${this.adminStatus?"Online":"Offline"}</p>
        </div>
      </div>
    `;const t=document.createElement("div");t.classList.add("chatroom__wrapper");const e=document.createElement("div");e.classList.add("chatroom__container");const i=document.createElement("textarea");i.setAttribute("id","chat-room__input"),i.setAttribute("type","text"),i.setAttribute("placeholder","chat..."),i.classList.add("chat__input");const n=document.createElement("div");n.classList.add("chat__line-divider");const s=document.createElement("div");s.classList.add("chat__input-divider");const a=document.createElement("div"),o=document.createElement("div"),h=document.createElement("h2");h.textContent="powered by ChatBüdy :)",a.classList.add("chat__footer"),o.appendChild(h),a.appendChild(o),t.appendChild(e),t.appendChild(n),t.appendChild(i),t.appendChild(s),t.appendChild(a),this.chatRoomContainer=e,this.chatRoomPage=t;const c=document.createElement("div");c.setAttribute("id","loading"),c.style.display="block";const r=document.createElement("div");r.classList.add("spinner"),c.appendChild(r),this.loadingAnimationDIV=c,this.loadingAnimationDIV.style.display="none",this.chatRoomContainer.appendChild(c),this.widgetContainer.appendChild(t);const p=this.widgetContainer.querySelector(".fa-arrow-right-from-arc"),u=this.widgetContainer.querySelector("#chat-room__input");this.chat_room_input=u,this.chat_input_divider=s,this.close_button=p,this.chat_room_input.addEventListener("input",_=>this.EmitIsTyping(_.target.value)),this.close_button.addEventListener("click",this.toggleOpen.bind(this)),this.chat_input_divider.classList.add("widget__hidden"),this.chat_room_input.classList.add("widget__hidden")}injectStyles(){const t=document.createElement("script");t.src="https://kit.fontawesome.com/76351f6769.js",t.crossOrigin="anonymous";const e=document.createElement("link");e.rel="preconnect",e.href="https://fonts.googleapis.com";const i=document.createElement("link");i.rel="preconnect",i.href="https://fonts.gstatic.com",i.crossOrigin="crossorigin";const n=document.createElement("link");n.href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600&display=swap",n.rel="stylesheet";const s=document.createElement("style");s.innerHTML=f.replace(/^\s+|\n/gm,""),document.head.appendChild(t),document.head.appendChild(s),document.head.appendChild(e),document.head.appendChild(i),document.head.appendChild(n)}hanldeChatStyles(t,e){const i=document.createElement("div"),n=document.createElement("span");i.classList.add("chatroom__chat"),t==="..."?(i.classList.add("left"),i.classList.add("is_typing_chat"),n.innerText=`${t}`,i.appendChild(n)):t&&e&&(i.classList.add(t==="agent"?"left":"right"),n.innerText=`${e}`,i.appendChild(n)),this.chatRoomContainer.appendChild(i),requestAnimationFrame(()=>{this.chatRoomContainer.scrollTop=this.chatRoomContainer.scrollHeight})}handleEmailSubmit(){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,e=this.chatroom__email_input.value.replace(/[^\w\s@.\-]/gi,"");t.test(e)&&this.chatroom__email_input.value!==""?(this.chatroom__email_input.classList.remove("set__input-error"),this.SetVisitorEmail(e),this.chatroom__email_input.value=""):(this.chatroom__email_input.value="",this.chatroom__email_input.classList.add("set__input-error"))}handleNopeSubmitEmail(){this.chatroom__email_input.value="",this.SetVisitorEmail("")}handleEmailFormState(){const t=document.createElement("div"),e=document.createElement("span");t.classList.add("chatroom__chat"),t.classList.add("left"),e.innerText=`${this.ask_email_copy}`,t.appendChild(e);const i=document.createElement("div");i.classList.add("chatroom__email-input-div");const n=document.createElement("input");n.setAttribute("type","text"),n.setAttribute("placeholder","email@adress.com"),n.classList.add("chatroom__email-input"),i.appendChild(n);const s=document.createElement("div");s.classList.add("chatroom__submit-btn-div");const a=document.createElement("button"),o=document.createElement("button");a.innerText="sure 👍",o.innerText="nope 👎",a.classList.add("chatroom__email-buttons"),o.classList.add("chatroom__email-buttons"),s.appendChild(a),s.appendChild(o),this.chatroom__sure_btn=a,this.chatroom__nope_btn=o,this.chatroom__email_input=n;const h=document.createElement("div");h.classList.add("chatroom__email-form-container"),this.emailFormContainer=h,this.emailFormContainer.appendChild(t),this.emailFormContainer.appendChild(i),this.emailFormContainer.appendChild(s),this.chatRoomContainer.appendChild(this.emailFormContainer),this.chatroom__sure_btn.addEventListener("click",this.handleEmailSubmit.bind(this)),this.chatroom__nope_btn.addEventListener("click",this.handleNopeSubmitEmail.bind(this)),requestAnimationFrame(()=>{this.chatRoomContainer.scrollTop=this.chatRoomContainer.scrollHeight})}handleConvoClosedMsg(){const t=document.createElement("div"),e=document.createElement("span");t.classList.add("chatroom__chat"),t.classList.add("left"),e.innerText="The conversation was closed by the admin, Thank you for you visit 👋",t.appendChild(e);const i=document.createElement("div");i.classList.add("closed__convo_btn-div");const n=document.createElement("button");n.innerText="New conversation 💬",n.classList.add("start__conversation-button"),i.appendChild(n),this.startNewConvoBtn=n;const s=document.createElement("div");s.classList.add("closed__convo_msg-container"),this.closedConversationMsgContainer=s,this.closedConversationMsgContainer.appendChild(t),this.closedConversationMsgContainer.appendChild(i),this.chatRoomContainer.appendChild(this.closedConversationMsgContainer),this.startNewConvoBtn.addEventListener("click",()=>{sessionStorage.removeItem("convoClosed"),this.LoadUpsequence(this.widgetID),this.toggleOpen(this)})}getChat(t){const{text:e,sender_type:i,type:n,status:s}=t;if(n==="..."&&s===!0){let a;this.hanldeChatStyles(n),clearTimeout(a),a=setTimeout(()=>{const o=this.chatRoomContainer.querySelector(".is_typing_chat");o&&this.chatRoomContainer.removeChild(o)},6e3)}else if(n==="admin-status")s?this.adminStatus=!0:this.adminStatus=!1;else{const a=this.chatRoomContainer.querySelector(".is_typing_chat");a&&this.chatRoomContainer.removeChild(a),this.hanldeChatStyles(i,e)}}async handleChatRoomState(t){if(t){const e=await m(this.widgetID,this.SSElink);if(e)return e.addEventListener("open",()=>{}),e.addEventListener("message",i=>{const n=JSON.parse(i.data);Array.isArray(n)?(this.loadingAnimationDIV.style.display="none",this.emailFormContainer&&(this.emailFormContainer.style.display="none"),this.chat_input_divider.classList.remove("widget__hidden"),this.chat_room_input.classList.remove("widget__hidden"),n.forEach(s=>{this.getChat(s)})):n.type==="ask-email"?(this.loadingAnimationDIV.style.display="none",this.handleEmailFormState()):(this.loadingAnimationDIV.style.display="none",this.chat_input_divider.classList.remove("widget__hidden"),this.chat_room_input.classList.remove("widget__hidden"),this.getChat(n))}),e.addEventListener("error",i=>{console.error("WebSocket error:",i)}),()=>{e.close()};e||(this.loadingAnimationDIV.style.display="none",this.handleConvoClosedMsg(),this.DOMLoaded=!1)}}handleUnreadChatState(){this.unreadChatCountSpan.textContent=this.unreadChatCount,this.unreadChatCount>0&&this.mainWidgetContainer.appendChild(this.unreadChatCountSpan)}async handleSSEConnection(){const t=await w(this.widgetID);t&&(this.SSElink=new EventSource(t.sse_link,{withCredentials:!0}),this.SSElink.addEventListener("message",e=>{const i=JSON.parse(e.data);i>0?(this.unreadChatCountSpan.textContent=i,this.buttonContainer.appendChild(this.unreadChatCountSpan)):this.buttonContainer.contains(this.unreadChatCountSpan)&&this.buttonContainer.removeChild(this.unreadChatCountSpan)}),this.SSElink.addEventListener("error",e=>{console.error("SSE Error:",e),this.SSElink.close()}))}toggleOpen(){this.open=!this.open,this.open?(this.widgetContainer.style.zIndex=30,this.buttonContainer.style.zIndex=50,this.SSElink&&this.SSElink.close(),this.handleChatRoomState(this.widgetID),this.widgetIcon.classList.add("widget__hidden"),this.sendIcon.classList.remove("widget__hidden"),this.loadingAnimationDIV.style.display="block",this.widgetContainer.classList.remove("content__hidden")):(this.createWidgetContent(),this.handleSSEConnection(),this.widgetContainer.style.removeProperty("z-index"),this.buttonContainer.style.removeProperty("z-index"),this.widgetIcon.classList.remove("widget__hidden"),this.sendIcon.classList.add("widget__hidden"),this.widgetContainer.classList.add("content__hidden"),this.stopChat(this.widgetID))}}const k=()=>new I;k();
