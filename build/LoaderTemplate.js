let useraccess="{{USER_HASH}}";const SetupIframe=async e=>{try{if(e){const t="<!DOCTYPE html></html>";e.style.display="none",e.title="ChatBudy chat widget code",e.setAttribute("srcdoc",t),document.body.appendChild(e),e.onload=async()=>{const t=e.contentDocument;if(t){const e=t.createElement("script");e.src="https://kit.fontawesome.com/76351f6769.js",e.crossOrigin="anonymous",t.head.appendChild(e);const o=t.createElement("link");o.rel="preconnect",o.href="https://fonts.googleapis.com";const s=t.createElement("link");s.rel="preconnect",s.href="https://fonts.gstatic.com",s.crossOrigin=!0;const a=t.createElement("link");a.href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600&display=swap",a.rel="stylesheet";const n=t.createElement("script");n.src="https://chat-buddy-widget.vercel.app/chatBudy.js",n.type="module",n.async=!0,t.head.appendChild(o),t.head.appendChild(s),t.head.appendChild(a),t.body.appendChild(n)}}}}catch(e){console.log("ERROR setting up the widget connection: ",e)}},GetWidgetStyle=async e=>{try{if(!localStorage.getItem("chatbudy_style")){const t=await fetch(`https://f76f-2607-fa49-d344-6500-7d16-a4ca-23d5-7012.ngrok-free.app/code/style-${e}`,{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"}),o=await t.json();o&&localStorage.setItem("chatbudy_style",JSON.stringify(o.widget_style))}}catch(e){console.log("ERROR setting up the widget style: ",e)}};export const setNewVisitor=async(e,t)=>{try{const o=await fetch(`https://f76f-2607-fa49-d344-6500-7d16-a4ca-23d5-7012.ngrok-free.app/visitor/new-visitor-${t}`,{method:"post",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({isoCode:e.info.country.iso_code,browser:navigator.userAgent})}),s=await o.json();return console.log(s),!0}catch(e){return console.log(e),!1}};export const initiateChat=async e=>{try{return await fetch("https://f76f-2607-fa49-d344-6500-7d16-a4ca-23d5-7012.ngrok-free.app/chat/new-room",{method:"post",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({user_hash:e})})||console.log("No chatrooms found...reset everything"),!0}catch(e){return console.log(e),!1}};export const LoadUpsequence=async e=>{try{if(sessionStorage.getItem("widgetLoaded")||sessionStorage.getItem("convoClosed"))return;const t=await fetch("https://f76f-2607-fa49-d344-6500-7d16-a4ca-23d5-7012.ngrok-free.app/visitor/visitor-info",{method:"get",headers:{"Content-Type":"application/json"}}),o=await t.json(),s=await setNewVisitor(o,e);if(await initiateChat(e)&&s){sessionStorage.setItem("widgetLoaded",!0);const t=JSON.stringify({access_id:e});localStorage.getItem("chatbudy_state")||localStorage.setItem("chatbudy_state",t),await GetWidgetStyle(e);const o=document.createElement("iframe");SetupIframe(o)}}catch(e){console.log("Load up sequence ERROR: ",e)}};document.addEventListener("DOMContentLoaded",(()=>{const e=document.createElement("iframe");SetupIframe(e),LoadUpsequence(useraccess)}));